/*! For license information please see 2a198a6f.8f7aa045.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[692],{2525:function(e){var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(o){return!1}}()?Object.assign:function(e,a){for(var i,l,u=o(e),c=1;c<arguments.length;c++){for(var s in i=Object(arguments[c]))n.call(i,s)&&(u[s]=i[s]);if(t){l=t(i);for(var p=0;p<l.length;p++)r.call(i,l[p])&&(u[l[p]]=i[l[p]])}}return u}},1535:function(e,t,n){var r=n(2525),o="function"==typeof Symbol&&Symbol.for,a=o?Symbol.for("react.element"):60103,i=o?Symbol.for("react.portal"):60106,l=o?Symbol.for("react.fragment"):60107,u=o?Symbol.for("react.strict_mode"):60108,c=o?Symbol.for("react.profiler"):60114,s=o?Symbol.for("react.provider"):60109,p=o?Symbol.for("react.context"):60110,d=o?Symbol.for("react.forward_ref"):60112,f=o?Symbol.for("react.suspense"):60113,h=o?Symbol.for("react.suspense_list"):60120,y=o?Symbol.for("react.memo"):60115,m=o?Symbol.for("react.lazy"):60116;o&&Symbol.for("react.fundamental"),o&&Symbol.for("react.responder"),o&&Symbol.for("react.scope");var b="function"==typeof Symbol&&Symbol.iterator;function g(e){for(var t=e.message,n="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)n+="&args[]="+encodeURIComponent(arguments[r]);return e.message="Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",e}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function w(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||k}function C(){}function N(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||k}w.prototype.isReactComponent={},w.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw g(Error(85));this.updater.enqueueSetState(this,e,t,"setState")},w.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},C.prototype=w.prototype;var R=N.prototype=new C;R.constructor=N,r(R,w.prototype),R.isPureReactComponent=!0;var E={current:null},x={suspense:null},O={current:null},S=Object.prototype.hasOwnProperty,_={key:!0,ref:!0,__self:!0,__source:!0};function I(e,t,n){var r,o={},i=null,l=null;if(null!=t)for(r in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(i=""+t.key),t)S.call(t,r)&&!_.hasOwnProperty(r)&&(o[r]=t[r]);var u=arguments.length-2;if(1===u)o.children=n;else if(1<u){for(var c=Array(u),s=0;s<u;s++)c[s]=arguments[s+2];o.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===o[r]&&(o[r]=u[r]);return{$$typeof:a,type:e,key:i,ref:l,props:o,_owner:O.current}}function j(e){return"object"==typeof e&&null!==e&&e.$$typeof===a}var P=/\/+/g,T=[];function A(e,t,n,r){if(T.length){var o=T.pop();return o.result=e,o.keyPrefix=t,o.func=n,o.context=r,o.count=0,o}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function U(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>T.length&&T.push(e)}function D(e,t,n,r){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case a:case i:l=!0}}if(l)return n(r,e,""===t?"."+H(e,0):t),1;if(l=0,t=""===t?".":t+":",Array.isArray(e))for(var u=0;u<e.length;u++){var c=t+H(o=e[u],u);l+=D(o,c,n,r)}else if(null===e||"object"!=typeof e?c=null:c="function"==typeof(c=b&&e[b]||e["@@iterator"])?c:null,"function"==typeof c)for(e=c.call(e),u=0;!(o=e.next()).done;)l+=D(o=o.value,c=t+H(o,u++),n,r);else if("object"===o)throw n=""+e,g(Error(31),"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,"");return l}function $(e,t,n){return null==e?0:D(e,"",t,n)}function H(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function q(e,t){e.func.call(e.context,t,e.count++)}function L(e,t,n){var r=e.result,o=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?M(e,r,n,(function(e){return e})):null!=e&&(j(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,o+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(P,"$&/")+"/")+n)),r.push(e))}function M(e,t,n,r,o){var a="";null!=n&&(a=(""+n).replace(P,"$&/")+"/"),$(e,L,t=A(t,a,r,o)),U(t)}function F(){var e=E.current;if(null===e)throw g(Error(321));return e}var G={Children:{map:function(e,t,n){if(null==e)return e;var r=[];return M(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;$(e,q,t=A(null,null,t,n)),U(t)},count:function(e){return $(e,(function(){return null}),null)},toArray:function(e){var t=[];return M(e,t,null,(function(e){return e})),t},only:function(e){if(!j(e))throw g(Error(143));return e}},createRef:function(){return{current:null}},Component:w,PureComponent:N,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:p,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:d,render:e}},lazy:function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:y,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return F().useCallback(e,t)},useContext:function(e,t){return F().useContext(e,t)},useEffect:function(e,t){return F().useEffect(e,t)},useImperativeHandle:function(e,t,n){return F().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return F().useLayoutEffect(e,t)},useMemo:function(e,t){return F().useMemo(e,t)},useReducer:function(e,t,n){return F().useReducer(e,t,n)},useRef:function(e){return F().useRef(e)},useState:function(e){return F().useState(e)},Fragment:l,Profiler:c,StrictMode:u,Suspense:f,unstable_SuspenseList:h,createElement:I,cloneElement:function(e,t,n){if(null==e)throw g(Error(267),e);var o=r({},e.props),i=e.key,l=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(l=t.ref,u=O.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(s in t)S.call(t,s)&&!_.hasOwnProperty(s)&&(o[s]=void 0===t[s]&&void 0!==c?c[s]:t[s])}var s=arguments.length-2;if(1===s)o.children=n;else if(1<s){c=Array(s);for(var p=0;p<s;p++)c[p]=arguments[p+2];o.children=c}return{$$typeof:a,type:e.type,key:i,ref:l,props:o,_owner:u}},createFactory:function(e){var t=I.bind(null,e);return t.type=e,t},isValidElement:j,version:"16.10.2",unstable_withSuspenseConfig:function(e,t){var n=x.suspense;x.suspense=void 0===t?null:t;try{e()}finally{x.suspense=n}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:E,ReactCurrentBatchConfig:x,ReactCurrentOwner:O,IsSomeRendererActing:{current:!1},assign:r}},V={default:G},X=V&&G||V;e.exports=X.default||X},7378:function(e,t,n){n(1535)},3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return f}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var u=r.createContext({}),c=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=c(e.components);return r.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),d=c(n),f=o,h=d["".concat(u,".").concat(f)]||d[f]||p[f]||a;return n?r.createElement(h,i(i({ref:t},s),{},{components:n})):r.createElement(h,i({ref:t},s))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9402:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return c},toc:function(){return s},default:function(){return d}});var r=n(7462),o=n(3366),a=(n(7378),n(3905)),i=["components"],l={id:"recipes",title:"Recipes",hide_title:!0},u="Recipes",c={unversionedId:"recipes",id:"recipes",isDocsHomePage:!1,title:"Recipes",description:"Throttling",source:"@site/../docs/Recipes.md",sourceDirName:".",slug:"/recipes",permalink:"/docs/recipes",editUrl:"https://github.com/redux-saga/redux-saga/edit/master/docs/../docs/Recipes.md",tags:[],version:"current",frontMatter:{id:"recipes",title:"Recipes",hide_title:!0},sidebar:"docs",previous:{title:"Using Run Saga",permalink:"/docs/advanced/UsingRunSaga"},next:{title:"External Resources",permalink:"/docs/ExternalResources"}},s=[{value:"Throttling",id:"throttling",children:[],level:2},{value:"Debouncing",id:"debouncing",children:[],level:2},{value:"Retrying XHR calls",id:"retrying-xhr-calls",children:[],level:2},{value:"Undo",id:"undo",children:[],level:2}],p={toc:s};function d(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"recipes"},"Recipes"),(0,a.kt)("h2",{id:"throttling"},"Throttling"),(0,a.kt)("p",null,"You can throttle a sequence of dispatched actions by using a handy built-in ",(0,a.kt)("inlineCode",{parentName:"p"},"throttle")," helper. For example, suppose the UI fires an ",(0,a.kt)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," action while the user is typing in a text field."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { throttle } from 'redux-saga/effects'\n\nfunction* handleInput(input) {\n  // ...\n}\n\nfunction* watchInput() {\n  yield throttle(500, 'INPUT_CHANGED', handleInput)\n}\n")),(0,a.kt)("p",null,"By using this helper the ",(0,a.kt)("inlineCode",{parentName:"p"},"watchInput")," won't start a new ",(0,a.kt)("inlineCode",{parentName:"p"},"handleInput")," task for 500ms, but in the same time it will still be accepting the latest ",(0,a.kt)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," actions into its underlaying ",(0,a.kt)("inlineCode",{parentName:"p"},"buffer"),", so it'll miss all ",(0,a.kt)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," actions happening in-between. This ensures that the Saga will take at most one ",(0,a.kt)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," action during each period of 500ms and still be able to process trailing action."),(0,a.kt)("h2",{id:"debouncing"},"Debouncing"),(0,a.kt)("p",null,"From redux-saga@v1 ",(0,a.kt)("a",{parentName:"p",href:"/docs/api#debouncems-pattern-saga-args"},"debounce")," is built-in effect."),(0,a.kt)("p",null,"Let's consider how the effect could be implemented as a combination of other base effects."),(0,a.kt)("p",null,"To debounce a sequence, put the built-in ",(0,a.kt)("inlineCode",{parentName:"p"},"delay")," helper in the forked task:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"\nimport { call, cancel, fork, take, delay } from 'redux-saga/effects'\n\nfunction* handleInput(input) {\n  // debounce by 500ms\n  yield delay(500)\n  ...\n}\n\nfunction* watchInput() {\n  let task\n  while (true) {\n    const { input } = yield take('INPUT_CHANGED')\n    if (task) {\n      yield cancel(task)\n    }\n    task = yield fork(handleInput, input)\n  }\n}\n")),(0,a.kt)("p",null,"In the above example ",(0,a.kt)("inlineCode",{parentName:"p"},"handleInput")," waits for 500ms before performing its logic. If the user types something during this period we'll get more ",(0,a.kt)("inlineCode",{parentName:"p"},"INPUT_CHANGED")," actions. Since ",(0,a.kt)("inlineCode",{parentName:"p"},"handleInput")," will still be blocked in the ",(0,a.kt)("inlineCode",{parentName:"p"},"delay")," call, it'll be cancelled by ",(0,a.kt)("inlineCode",{parentName:"p"},"watchInput")," before it can start performing its logic."),(0,a.kt)("p",null,"Example above could be rewritten with redux-saga ",(0,a.kt)("inlineCode",{parentName:"p"},"takeLatest")," helper:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"\nimport { call, takeLatest, delay } from 'redux-saga/effects'\n\nfunction* handleInput({ input }) {\n  // debounce by 500ms\n  yield delay(500)\n  ...\n}\n\nfunction* watchInput() {\n  // will cancel current running handleInput task\n  yield takeLatest('INPUT_CHANGED', handleInput);\n}\n")),(0,a.kt)("h2",{id:"retrying-xhr-calls"},"Retrying XHR calls"),(0,a.kt)("p",null,"From redux-saga@v1 ",(0,a.kt)("a",{parentName:"p",href:"/docs/api#retrymaxtries-delay-fn-args"},"retry")," is built-in effect."),(0,a.kt)("p",null,"Let's consider how the effect could be implemented as a combination of other base effects."),(0,a.kt)("p",null,"To retry an XHR call for a specific amount of times, use a for loop with a delay:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"\nimport { call, put, take, delay } from 'redux-saga/effects'\n\nfunction* updateApi(data) {\n  for(let i = 0; i < 5; i++) {\n    try {\n      const apiResponse = yield call(apiRequest, { data });\n      return apiResponse;\n    } catch(err) {\n      if(i < 4) {\n        yield delay(2000);\n      }\n    }\n  }\n  // attempts failed after 5 attempts\n  throw new Error('API request failed');\n}\n\nexport default function* updateResource() {\n  while (true) {\n    const { data } = yield take('UPDATE_START');\n    try {\n      const apiResponse = yield call(updateApi, data);\n      yield put({\n        type: 'UPDATE_SUCCESS',\n        payload: apiResponse.body,\n      });\n    } catch (error) {\n      yield put({\n        type: 'UPDATE_ERROR',\n        error\n      });\n    }\n  }\n}\n\n")),(0,a.kt)("p",null,"In the above example the ",(0,a.kt)("inlineCode",{parentName:"p"},"apiRequest")," will be retried for 5 times, with a delay of 2 seconds in between. After the 5th failure, the exception thrown will get caught by the parent saga, which will dispatch the ",(0,a.kt)("inlineCode",{parentName:"p"},"UPDATE_ERROR")," action."),(0,a.kt)("p",null,"If you want unlimited retries, then the ",(0,a.kt)("inlineCode",{parentName:"p"},"for")," loop can be replaced with a ",(0,a.kt)("inlineCode",{parentName:"p"},"while (true)"),". Also instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"take")," you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"takeLatest"),", so only the last request will be retried. By adding an ",(0,a.kt)("inlineCode",{parentName:"p"},"UPDATE_RETRY")," action in the error handling, we can inform the user that the update was not successful but it will be retried."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { delay } from 'redux-saga/effects'\n\nfunction* updateApi(data) {\n  while (true) {\n    try {\n      const apiResponse = yield call(apiRequest, { data });\n      return apiResponse;\n    } catch(error) {\n      yield put({\n        type: 'UPDATE_RETRY',\n        error\n      })\n      yield delay(2000);\n    }\n  }\n}\n\nfunction* updateResource({ data }) {\n  const apiResponse = yield call(updateApi, data);\n  yield put({\n    type: 'UPDATE_SUCCESS',\n    payload: apiResponse.body,\n  });\n}\n\nexport function* watchUpdateResource() {\n  yield takeLatest('UPDATE_START', updateResource);\n}\n\n")),(0,a.kt)("h2",{id:"undo"},"Undo"),(0,a.kt)("p",null,"The ability to undo respects the user by allowing the action to happen smoothly\nfirst and foremost before assuming they don't know what they are doing. ",(0,a.kt)("a",{parentName:"p",href:"https://goodui.org/#8"},"GoodUI"),"\nThe ",(0,a.kt)("a",{parentName:"p",href:"https://redux.js.org/recipes/implementing-undo-history#understanding-undo-history"},"redux documentation")," describes a\nrobust way to implement an undo based on modifying the reducer to contain ",(0,a.kt)("inlineCode",{parentName:"p"},"past"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"present"),",\nand ",(0,a.kt)("inlineCode",{parentName:"p"},"future")," state.  There is even a library ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/omnidan/redux-undo"},"redux-undo")," that\ncreates a higher order reducer to do most of the heavy lifting for the developer."),(0,a.kt)("p",null,"However, this method comes with overhead because it stores references to the previous state(s) of the application."),(0,a.kt)("p",null,"Using redux-saga's ",(0,a.kt)("inlineCode",{parentName:"p"},"delay")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"race")," we can implement a basic, one-time undo without enhancing\nour reducer or storing the previous state."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"import { take, put, call, spawn, race, delay } from 'redux-saga/effects'\nimport { updateThreadApi, actions } from 'somewhere'\n\nfunction* onArchive(action) {\n\n  const { threadId } = action\n  const undoId = `UNDO_ARCHIVE_${threadId}`\n\n  const thread = { id: threadId, archived: true }\n\n  // show undo UI element, and provide a key to communicate\n  yield put(actions.showUndo(undoId))\n\n  // optimistically mark the thread as `archived`\n  yield put(actions.updateThread(thread))\n\n  // allow the user 5 seconds to perform undo.\n  // after 5 seconds, 'archive' will be the winner of the race-condition\n  const { undo, archive } = yield race({\n    undo: take(action => action.type === 'UNDO' && action.undoId === undoId),\n    archive: delay(5000)\n  })\n\n  // hide undo UI element, the race condition has an answer\n  yield put(actions.hideUndo(undoId))\n\n  if (undo) {\n    // revert thread to previous state\n    yield put(actions.updateThread({ id: threadId, archived: false }))\n  } else if (archive) {\n    // make the API call to apply the changes remotely\n    yield call(updateThreadApi, thread)\n  }\n}\n\nfunction* main() {\n  while (true) {\n    // wait for an ARCHIVE_THREAD to happen\n    const action = yield take('ARCHIVE_THREAD')\n    // use spawn to execute onArchive in a non-blocking fashion, which also\n    // prevents cancellation when main saga gets cancelled.\n    // This helps us in keeping state in sync between server and client\n    yield spawn(onArchive, action)\n  }\n}\n")))}d.isMDXComponent=!0}}]);