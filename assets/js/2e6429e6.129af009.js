/*! For license information please see 2e6429e6.129af009.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[810],{2525:function(e){var t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach((function(e){a[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},a)).join("")}catch(r){return!1}}()?Object.assign:function(e,s){for(var o,l,i=r(e),c=1;c<arguments.length;c++){for(var u in o=Object(arguments[c]))n.call(o,u)&&(i[u]=o[u]);if(t){l=t(o);for(var p=0;p<l.length;p++)a.call(o,l[p])&&(i[l[p]]=o[l[p]])}}return i}},1535:function(e,t,n){var a=n(2525),r="function"==typeof Symbol&&Symbol.for,s=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,l=r?Symbol.for("react.fragment"):60107,i=r?Symbol.for("react.strict_mode"):60108,c=r?Symbol.for("react.profiler"):60114,u=r?Symbol.for("react.provider"):60109,p=r?Symbol.for("react.context"):60110,d=r?Symbol.for("react.forward_ref"):60112,f=r?Symbol.for("react.suspense"):60113,g=r?Symbol.for("react.suspense_list"):60120,h=r?Symbol.for("react.memo"):60115,m=r?Symbol.for("react.lazy"):60116;r&&Symbol.for("react.fundamental"),r&&Symbol.for("react.responder"),r&&Symbol.for("react.scope");var y="function"==typeof Symbol&&Symbol.iterator;function b(e){for(var t=e.message,n="https://reactjs.org/docs/error-decoder.html?invariant="+t,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return e.message="Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings. ",e}var k={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function x(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||k}function w(){}function S(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||k}x.prototype.isReactComponent={},x.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw b(Error(85));this.updater.enqueueSetState(this,e,t,"setState")},x.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=x.prototype;var N=S.prototype=new w;N.constructor=S,a(N,x.prototype),N.isPureReactComponent=!0;var C={current:null},O={suspense:null},T={current:null},E=Object.prototype.hasOwnProperty,j={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,n){var a,r={},o=null,l=null;if(null!=t)for(a in void 0!==t.ref&&(l=t.ref),void 0!==t.key&&(o=""+t.key),t)E.call(t,a)&&!j.hasOwnProperty(a)&&(r[a]=t[a]);var i=arguments.length-2;if(1===i)r.children=n;else if(1<i){for(var c=Array(i),u=0;u<i;u++)c[u]=arguments[u+2];r.children=c}if(e&&e.defaultProps)for(a in i=e.defaultProps)void 0===r[a]&&(r[a]=i[a]);return{$$typeof:s,type:e,key:o,ref:l,props:r,_owner:T.current}}function A(e){return"object"==typeof e&&null!==e&&e.$$typeof===s}var R=/\/+/g,P=[];function U(e,t,n,a){if(P.length){var r=P.pop();return r.result=e,r.keyPrefix=t,r.func=n,r.context=a,r.count=0,r}return{result:e,keyPrefix:t,func:n,context:a,count:0}}function F(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>P.length&&P.push(e)}function I(e,t,n,a){var r=typeof e;"undefined"!==r&&"boolean"!==r||(e=null);var l=!1;if(null===e)l=!0;else switch(r){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case s:case o:l=!0}}if(l)return n(a,e,""===t?"."+H(e,0):t),1;if(l=0,t=""===t?".":t+":",Array.isArray(e))for(var i=0;i<e.length;i++){var c=t+H(r=e[i],i);l+=I(r,c,n,a)}else if(null===e||"object"!=typeof e?c=null:c="function"==typeof(c=y&&e[y]||e["@@iterator"])?c:null,"function"==typeof c)for(e=c.call(e),i=0;!(r=e.next()).done;)l+=I(r=r.value,c=t+H(r,i++),n,a);else if("object"===r)throw n=""+e,b(Error(31),"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,"");return l}function M(e,t,n){return null==e?0:I(e,"",t,n)}function H(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function q(e,t){e.func.call(e.context,t,e.count++)}function D(e,t,n){var a=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?$(e,a,n,(function(e){return e})):null!=e&&(A(e)&&(e=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,r+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(R,"$&/")+"/")+n)),a.push(e))}function $(e,t,n,a,r){var s="";null!=n&&(s=(""+n).replace(R,"$&/")+"/"),M(e,D,t=U(t,s,a,r)),F(t)}function L(){var e=C.current;if(null===e)throw b(Error(321));return e}var B={Children:{map:function(e,t,n){if(null==e)return e;var a=[];return $(e,a,null,t,n),a},forEach:function(e,t,n){if(null==e)return e;M(e,q,t=U(null,null,t,n)),F(t)},count:function(e){return M(e,(function(){return null}),null)},toArray:function(e){var t=[];return $(e,t,null,(function(e){return e})),t},only:function(e){if(!A(e))throw b(Error(143));return e}},createRef:function(){return{current:null}},Component:x,PureComponent:S,createContext:function(e,t){return void 0===t&&(t=null),(e={$$typeof:p,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:u,_context:e},e.Consumer=e},forwardRef:function(e){return{$$typeof:d,render:e}},lazy:function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},memo:function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},useCallback:function(e,t){return L().useCallback(e,t)},useContext:function(e,t){return L().useContext(e,t)},useEffect:function(e,t){return L().useEffect(e,t)},useImperativeHandle:function(e,t,n){return L().useImperativeHandle(e,t,n)},useDebugValue:function(){},useLayoutEffect:function(e,t){return L().useLayoutEffect(e,t)},useMemo:function(e,t){return L().useMemo(e,t)},useReducer:function(e,t,n){return L().useReducer(e,t,n)},useRef:function(e){return L().useRef(e)},useState:function(e){return L().useState(e)},Fragment:l,Profiler:c,StrictMode:i,Suspense:f,unstable_SuspenseList:g,createElement:_,cloneElement:function(e,t,n){if(null==e)throw b(Error(267),e);var r=a({},e.props),o=e.key,l=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(l=t.ref,i=T.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(u in t)E.call(t,u)&&!j.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==c?c[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=n;else if(1<u){c=Array(u);for(var p=0;p<u;p++)c[p]=arguments[p+2];r.children=c}return{$$typeof:s,type:e.type,key:o,ref:l,props:r,_owner:i}},createFactory:function(e){var t=_.bind(null,e);return t.type=e,t},isValidElement:A,version:"16.10.2",unstable_withSuspenseConfig:function(e,t){var n=O.suspense;O.suspense=void 0===t?null:t;try{e()}finally{O.suspense=n}},__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentDispatcher:C,ReactCurrentBatchConfig:O,ReactCurrentOwner:T,IsSomeRendererActing:{current:!1},assign:a}},G={default:B},V=G&&B||G;e.exports=V.default||V},7378:function(e,t,n){n(1535)},3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return f}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=c(n),f=r,g=d["".concat(i,".").concat(f)]||d[f]||p[f]||s;return n?a.createElement(g,o(o({ref:t},u),{},{components:n})):a.createElement(g,o({ref:t},u))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<s;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1946:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return i},metadata:function(){return c},toc:function(){return u},default:function(){return d}});var a=n(7462),r=n(3366),s=(n(7378),n(3905)),o=["components"],l={title:"Testing",hide_title:!0},i="Testing Sagas",c={unversionedId:"advanced/Testing",id:"advanced/Testing",isDocsHomePage:!1,title:"Testing",description:"There are two main ways to test Sagas: testing the saga generator function step-by-step or running the full saga and",source:"@site/../docs/advanced/Testing.md",sourceDirName:"advanced",slug:"/advanced/Testing",permalink:"/docs/advanced/Testing",editUrl:"https://github.com/redux-saga/redux-saga/edit/master/docs/../docs/advanced/Testing.md",tags:[],version:"current",frontMatter:{title:"Testing",hide_title:!0},sidebar:"docs",previous:{title:"Task Cancellation",permalink:"/docs/advanced/TaskCancellation"},next:{title:"Using Run Saga",permalink:"/docs/advanced/UsingRunSaga"}},u=[{value:"Testing the Saga Generator Function",id:"testing-the-saga-generator-function",children:[{value:"Branching Saga",id:"branching-saga",children:[],level:3}],level:2},{value:"Testing the full Saga",id:"testing-the-full-saga",children:[],level:2},{value:"Testing libraries",id:"testing-libraries",children:[{value:"<code>redux-saga-test</code> and <code>redux-saga-testing</code> for step-by-step testing",id:"redux-saga-test-and-redux-saga-testing-for-step-by-step-testing",children:[],level:3},{value:"<code>redux-saga-test-plan</code>",id:"redux-saga-test-plan",children:[],level:3},{value:"redux-saga-test-engine",id:"redux-saga-test-engine",children:[],level:3},{value:"redux-saga-tester",id:"redux-saga-tester",children:[],level:3}],level:2},{value:"<code>effectMiddlewares</code>",id:"effectmiddlewares",children:[],level:2}],p={toc:u};function d(e){var t=e.components,n=(0,r.Z)(e,o);return(0,s.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"testing-sagas"},"Testing Sagas"),(0,s.kt)("p",null,"There are two main ways to test Sagas: testing the saga generator function step-by-step or running the full saga and\nasserting the side effects."),(0,s.kt)("h2",{id:"testing-the-saga-generator-function"},"Testing the Saga Generator Function"),(0,s.kt)("p",null,"Suppose we have the following actions:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const CHOOSE_COLOR = 'CHOOSE_COLOR';\nconst CHANGE_UI = 'CHANGE_UI';\n\nconst chooseColor = (color) => ({\n  type: CHOOSE_COLOR,\n  payload: {\n    color,\n  },\n});\n\nconst changeUI = (color) => ({\n  type: CHANGE_UI,\n  payload: {\n    color,\n  },\n});\n")),(0,s.kt)("p",null,"We want to test the saga:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"function* changeColorSaga() {\n  const action = yield take(CHOOSE_COLOR);\n  yield put(changeUI(action.payload.color));\n}\n")),(0,s.kt)("p",null,"Since Sagas always yield an Effect, and these effects have basic factory functions (e.g. put, take etc.) a test may\ninspect the yielded effect and compare it to an expected effect. To get the first yielded value from a saga,\ncall its ",(0,s.kt)("inlineCode",{parentName:"p"},"next().value"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"  const gen = changeColorSaga();\n\n  assert.deepEqual(\n    gen.next().value,\n    take(CHOOSE_COLOR),\n    'it should wait for a user to choose a color'\n  );\n")),(0,s.kt)("p",null,"A value must then be returned to assign to the ",(0,s.kt)("inlineCode",{parentName:"p"},"action")," constant, which is used for the argument to the ",(0,s.kt)("inlineCode",{parentName:"p"},"put")," effect:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"  const color = 'red';\n  assert.deepEqual(\n    gen.next(chooseColor(color)).value,\n    put(changeUI(color)),\n    'it should dispatch an action to change the ui'\n  );\n")),(0,s.kt)("p",null,"Since there are no more ",(0,s.kt)("inlineCode",{parentName:"p"},"yield"),"s, then next time ",(0,s.kt)("inlineCode",{parentName:"p"},"next()")," is called, the generator will be done:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"  assert.deepEqual(\n    gen.next().done,\n    true,\n    'it should be done'\n  );\n")),(0,s.kt)("h3",{id:"branching-saga"},"Branching Saga"),(0,s.kt)("p",null,"Sometimes your saga will have different outcomes. To test the different branches without repeating all the steps that lead to it you can use the utility function ",(0,s.kt)("strong",{parentName:"p"},"cloneableGenerator")),(0,s.kt)("p",null,"This time we add two new actions, ",(0,s.kt)("inlineCode",{parentName:"p"},"CHOOSE_NUMBER")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"DO_STUFF"),", with a related action creators:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const CHOOSE_NUMBER = 'CHOOSE_NUMBER';\nconst DO_STUFF = 'DO_STUFF';\n\nconst chooseNumber = (number) => ({\n  type: CHOOSE_NUMBER,\n  payload: {\n    number,\n  },\n});\n\nconst doStuff = () => ({\n  type: DO_STUFF,\n});\n")),(0,s.kt)("p",null,"Now the saga under test will put two ",(0,s.kt)("inlineCode",{parentName:"p"},"DO_STUFF")," actions before waiting for a ",(0,s.kt)("inlineCode",{parentName:"p"},"CHOOSE_NUMBER")," action and then putting\neither ",(0,s.kt)("inlineCode",{parentName:"p"},"changeUI('red')")," or ",(0,s.kt)("inlineCode",{parentName:"p"},"changeUI('blue')"),", depending on whether the number is even or odd."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"function* doStuffThenChangeColor() {\n  yield put(doStuff());\n  yield put(doStuff());\n  const action = yield take(CHOOSE_NUMBER);\n  if (action.payload.number % 2 === 0) {\n    yield put(changeUI('red'));\n  } else {\n    yield put(changeUI('blue'));\n  }\n}\n")),(0,s.kt)("p",null,"The test is as follows:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import { put, take } from 'redux-saga/effects';\nimport { cloneableGenerator } from '@redux-saga/testing-utils';\n\ntest('doStuffThenChangeColor', assert => {\n  const gen = cloneableGenerator(doStuffThenChangeColor)();\n  gen.next(); // DO_STUFF\n  gen.next(); // DO_STUFF\n  gen.next(); // CHOOSE_NUMBER\n\n  assert.test('user choose an even number', a => {\n    // cloning the generator before sending data\n    const clone = gen.clone();\n    a.deepEqual(\n      clone.next(chooseNumber(2)).value,\n      put(changeUI('red')),\n      'should change the color to red'\n    );\n\n    a.equal(\n      clone.next().done,\n      true,\n      'it should be done'\n    );\n\n    a.end();\n  });\n\n  assert.test('user choose an odd number', a => {\n    const clone = gen.clone();\n    a.deepEqual(\n      clone.next(chooseNumber(3)).value,\n      put(changeUI('blue')),\n      'should change the color to blue'\n    );\n\n    a.equal(\n      clone.next().done,\n      true,\n      'it should be done'\n    );\n\n    a.end();\n  });\n});\n")),(0,s.kt)("p",null,"See also: ",(0,s.kt)("a",{parentName:"p",href:"/docs/advanced/TaskCancellation"},"Task cancellation")," for testing fork effects"),(0,s.kt)("h2",{id:"testing-the-full-saga"},"Testing the full Saga"),(0,s.kt)("p",null,"Although it may be useful to test each step of a saga, in practise this makes for brittle tests. Instead, it may be\npreferable to run the whole saga and assert that the expected effects have occurred."),(0,s.kt)("p",null,"Suppose we have a basic saga which calls an HTTP API:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"function* callApi(url) {\n  const someValue = yield select(somethingFromState);\n  try {\n    const result = yield call(myApi, url, someValue);\n    yield put(success(result.json()));\n    return result.status;\n  } catch (e) {\n    yield put(error(e));\n    return -1;\n  }\n}\n")),(0,s.kt)("p",null,"We can run the saga with mocked values:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const dispatched = [];\n\nconst saga = runSaga({\n  dispatch: (action) => dispatched.push(action),\n  getState: () => ({ value: 'test' }),\n}, callApi, 'http://url');\n")),(0,s.kt)("p",null,"A test could then be written to assert the dispatched actions and mock calls:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import sinon from 'sinon';\nimport * as api from './api';\n\ntest('callApi', async (assert) => {\n  const dispatched = [];\n  sinon.stub(api, 'myApi').callsFake(() => ({\n    json: () => ({\n      some: 'value'\n    })\n  }));\n  const url = 'http://url';\n  const result = await runSaga({\n    dispatch: (action) => dispatched.push(action),\n    getState: () => ({ state: 'test' }),\n  }, callApi, url).toPromise();\n\n  assert.true(myApi.calledWith(url, somethingFromState({ state: 'test' })));\n  assert.deepEqual(dispatched, [success({ some: 'value' })]);\n});\n")),(0,s.kt)("p",null,"See also: Repository Examples:"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/redux-saga/redux-saga/blob/master/examples/counter/test/sagas.js"},"https://github.com/redux-saga/redux-saga/blob/master/examples/counter/test/sagas.js")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://github.com/redux-saga/redux-saga/blob/master/examples/shopping-cart/test/sagas.js"},"https://github.com/redux-saga/redux-saga/blob/master/examples/shopping-cart/test/sagas.js")),(0,s.kt)("h2",{id:"testing-libraries"},"Testing libraries"),(0,s.kt)("p",null,"While both of the above testing methods can be written natively, there exist several libraries to make both methods easier. Additionally, some libraries can be used to test sagas in a ",(0,s.kt)("em",{parentName:"p"},"third")," way: recording specific side-effects (but not all)."),(0,s.kt)("p",null,"Sam Hogarth's (@sh1989) ",(0,s.kt)("a",{parentName:"p",href:"http://blog.scottlogic.com/2018/01/16/evaluating-redux-saga-test-libraries.html"},"article")," summarizes the different options well."),(0,s.kt)("p",null,"For testing each generator yield step-by-step there is ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/stoeffel/redux-saga-test"},(0,s.kt)("inlineCode",{parentName:"a"},"redux-saga-test"))," and ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/antoinejaussoin/redux-saga-testing/"},(0,s.kt)("inlineCode",{parentName:"a"},"redux-saga-testing")),". ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/DNAinfo/redux-saga-test-engine"},(0,s.kt)("inlineCode",{parentName:"a"},"redux-saga-test-engine"))," is for recording and testing for specific side effects. For an integration test, ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/wix/redux-saga-tester"},(0,s.kt)("inlineCode",{parentName:"a"},"redux-saga-tester")),". And ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/jfairbank/redux-saga-test-plan"},(0,s.kt)("inlineCode",{parentName:"a"},"redux-saga-test-plan"))," can actually cover all three bases."),(0,s.kt)("h3",{id:"redux-saga-test-and-redux-saga-testing-for-step-by-step-testing"},(0,s.kt)("inlineCode",{parentName:"h3"},"redux-saga-test")," and ",(0,s.kt)("inlineCode",{parentName:"h3"},"redux-saga-testing")," for step-by-step testing"),(0,s.kt)("p",null,"The ",(0,s.kt)("inlineCode",{parentName:"p"},"redux-saga-test")," library provides syntactic sugar for your step-by-step tests. The ",(0,s.kt)("inlineCode",{parentName:"p"},"fromGenerator")," function returns a value that can be iterated manually with ",(0,s.kt)("inlineCode",{parentName:"p"},".next()")," and have an assertion made using the relevant saga effect method."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import fromGenerator from 'redux-saga-test';\n\ntest('with redux-saga-test', () => {\n  const generator = callApi('url');\n  /*\n  * The assertions passed to fromGenerator\n  * requires a `deepEqual` method\n  */\n  const expect = fromGenerator(assertions, generator);\n\n  expect.next().select(somethingFromState);\n  expect.next(selectedData).call(myApi, 'url', selectedData);\n  expect.next(result).put(success(result.json));\n});\n")),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"redux-saga-testing")," library provides a method ",(0,s.kt)("inlineCode",{parentName:"p"},"sagaHelper")," that takes your generator and returns a value that works a lot like Jest's ",(0,s.kt)("inlineCode",{parentName:"p"},"it()")," function, but also advances the generator being tested. The ",(0,s.kt)("inlineCode",{parentName:"p"},"result")," parameter passed into the callback is the value yielded by the generater"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import sagaHelper from 'redux-saga-testing';\n\ntest('with redux-saga-testing', () => {\n  const it = sagaHelper(callApi());\n\n  it('should select from state', selectResult => {\n    // with Jest's `expect`\n    expect(selectResult).toBe(value);\n  });\n\n  it('should select from state', apiResponse => {\n    // without tape's `test`\n    assert.deepEqual(apiResponse.json(), jsonResponse);\n  });\n\n  // an empty call to `it` can be used to skip an effect\n  it('', () => {});\n});\n")),(0,s.kt)("h3",{id:"redux-saga-test-plan"},(0,s.kt)("inlineCode",{parentName:"h3"},"redux-saga-test-plan")),(0,s.kt)("p",null,"This is the most versatile library. The ",(0,s.kt)("inlineCode",{parentName:"p"},"testSaga")," API is used for exact order testing and ",(0,s.kt)("inlineCode",{parentName:"p"},"expectSaga")," is for both recording side-effects and integration testing."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import { expectSaga, testSaga } from 'redux-saga-test-plan';\n\ntest('exact order with redux-saga-test-plan', () => {\n  return testSaga(callApi, 'url')\n    .next()\n    .select(selectFromState)\n    .next()\n    .call(myApi, 'url', valueFromSelect);\n\n    ...\n});\n\ntest('recorded effects with redux-saga-test-plan', () => {\n  /*\n  * With expectSaga, you can assert that any yield from\n  * your saga occurs as expected, *regardless of order*.\n  * You must call .run() at the end.\n  */\n  return expectSaga(callApi, 'url')\n    .put(success(value)) // last effect from our saga, first one tested\n\n    .call(myApi, 'url', value)\n    .run();\n    /* notice no assertion for the select call */\n});\n\ntest('test only final effect with .provide()', () => {\n  /*\n  * With the .provide() method from expectSaga\n  * you can by pass in all expected values\n  * and test only your saga's final effect.\n  */\n  return expectSaga(callApi, 'url')\n    .provide([\n      [select(selectFromState), selectedValue],\n      [call(myApi, 'url', selectedValue), response]\n    ])\n    .put(success(response))\n    .run();\n});\n\ntest('integration test with withReducer', () => {\n  /*\n  * Using `withReducer` allows you to test\n  * the state shape upon completion of your reducer -\n  * a true integration test for your Redux store management.\n  */\n\n  return expectSaga(callApi, 'url')\n    .withReducer(myReducer)\n    .provide([\n      [call(myApi, 'url', value), response]\n    ])\n    .hasFinalState({\n      data: response\n    })\n    .run();\n});\n")),(0,s.kt)("h3",{id:"redux-saga-test-engine"},"redux-saga-test-engine"),(0,s.kt)("p",null,"This library functions very similarly in setup to ",(0,s.kt)("inlineCode",{parentName:"p"},"redux-saga-test-plan"),", but is best used to record effects. Provide a collection of saga generic effects to be watched by ",(0,s.kt)("inlineCode",{parentName:"p"},"createSagaTestEngine")," function which in turn returns a function. Then provide your saga and specific effects and their arguments."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"const collectedEffects  = createSagaTestEngine(['SELECT', 'CALL', 'PUT']);\nconst actualEffects = collectEffects(mySaga, [ [myEffect(arg), value], ... ], argsToMySaga);\n")),(0,s.kt)("p",null,"The value of ",(0,s.kt)("inlineCode",{parentName:"p"},"actualEffects")," is an array containing elements equal to the yielded values from all ",(0,s.kt)("em",{parentName:"p"},"collected")," effects, in order of occurence."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import createSagaTestEngine from 'redux-saga-test-engine';\n\ntest('testing with redux-saga-test-engine', () => {\n  const collectEffects = createSagaTestEngine(['CALL', 'PUT']);\n\n  const actualEffects = collectEffects(\n    callApi,\n    [\n      [select(selectFromState), selectedValue],\n      [call(myApi, 'url', selectedValue), response]\n    ],\n    // Any further args are passed to the saga\n    // Here it is our URL, but typically would be the dispatched action\n    'url'\n  );\n\n  // assert that the effects you care about occurred as expected, in order\n  assert.equal(actualEffects[0], call(myApi, 'url', selectedValue));\n  assert.equal(actualEffects[1], put(success, response));\n\n  // assert that your saga does nothing unexpected\n  assert.true(actualEffects.length === 2);\n});\n")),(0,s.kt)("h3",{id:"redux-saga-tester"},"redux-saga-tester"),(0,s.kt)("p",null,"A final library to consider for integration testing. this library provides a ",(0,s.kt)("inlineCode",{parentName:"p"},"sagaTester")," class, to which you instantiate with your store's initial state and your reducer."),(0,s.kt)("p",null,"To test your saga, the ",(0,s.kt)("inlineCode",{parentName:"p"},"sagaTester")," instance ",(0,s.kt)("inlineCode",{parentName:"p"},"start()")," method with your saga and its argument(s). This runs your saga to its end. Then you may assert that effects occured, actions were dispatched and the state was updated as expected."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"import SagaTester from 'redux-saga-tester';\n\ntest('with redux-saga-tester', () => {\n  const sagaTester = new SagaTester({\n    initialState: defaultState,\n    reducers: reducer\n  });\n\n  sagaTester.start(callApi);\n\n  sagaTester.dispatch(actionToTriggerSaga());\n\n  await sagaTester.waitFor(success);\n\n  assert.true(sagaTester.wasCalled(success(response)));\n\n  assert.deepEqual(sagaTester.getState(), { data: response });\n});\n")),(0,s.kt)("h2",{id:"effectmiddlewares"},(0,s.kt)("inlineCode",{parentName:"h2"},"effectMiddlewares")),(0,s.kt)("p",null,"Provides a native way to perform integration like testing without one of the above libraries."),(0,s.kt)("p",null,"The idea is that you can create a real redux store with saga middleware in your test file. The saga middleware takes an object as an argument. That object would have an ",(0,s.kt)("inlineCode",{parentName:"p"},"effectMiddlewares")," value: a function where you can intercept/hijack any effect and resolve it on your own - passing it very redux-style to the next middleware."),(0,s.kt)("p",null,"In your test, you would start a saga, intercept/resolve async effects with effectMiddlewares and assert on things like state updates to test integration between your saga and a store."),(0,s.kt)("p",null,"Here's an example from the ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/redux-saga/redux-saga/blob/34c9093684323ab92eacdf2df958f31d9873d3b1/test/interpreter/effectMiddlewares.js#L88"},"docs"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"test('effectMiddleware', assert => {\n  assert.plan(1);\n\n  let actual = [];\n\n  function rootReducer(state = {}, action) {\n    return action;\n  }\n\n  const effectMiddleware = next => effect => {\n    if (effect === apiCall) {\n      Promise.resolve().then(() => next('injected value'));\n      return;\n    }\n    return next(effect);\n  };\n\n  const middleware = sagaMiddleware({ effectMiddlewares: [effectMiddleware] });\n  const store = createStore(rootReducer, {}, applyMiddleware(middleware));\n\n  const apiCall = call(() => new Promise(() => {}));\n\n  function* root() {\n    actual.push(yield all([call(fnA), apiCall]));\n  }\n\n  function* fnA() {\n    const result = [];\n    result.push((yield take('ACTION-1')).val);\n    result.push((yield take('ACTION-2')).val);\n    return result;\n  }\n\n  const task = middleware.run(root)\n\n  Promise.resolve()\n    .then(() => store.dispatch({ type: 'ACTION-1', val: 1 }))\n    .then(() => store.dispatch({ type: 'ACTION-2', val: 2 }));\n\n  const expected = [[[1, 2], 'injected value']];\n\n  task\n    .toPromise()\n    .then(() => {\n      assert.deepEqual(\n        actual,\n        expected,\n        'effectMiddleware must be able to intercept and resolve effect in a custom way',\n      )\n    })\n    .catch(err => assert.fail(err));\n});\n")))}d.isMDXComponent=!0}}]);